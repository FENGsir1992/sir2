# VPN 环境配置指南

## 🔐 VPN 环境下的登录问题解决方案

如果您在 VPN 环境下遇到管理员登录问题，请按照以下步骤配置：

## 📋 快速解决步骤

### 1. 创建环境配置文件

在项目根目录创建 `.env.local` 文件：

```bash
# 复制环境变量模板
cp env.example .env.local
```

在 `.env.local` 中设置：

```env
# VPN模式启用
VITE_VPN_MODE=true

# 或者直接指定后端地址
VITE_API_BASE_URL=http://127.0.0.1:3002/api
```

### 2. 确认后端服务器绑定

确保后端服务器监听所有网络接口，在 `backend` 目录下创建 `.env` 文件：

```env
# 服务器端口
PORT=3002

# 开发环境
NODE_ENV=development

# 前端URL（VPN环境）
FRONTEND_URL=http://127.0.0.1:5173
```

### 3. 重启服务

```bash
# 停止所有服务
# 在后端目录
cd backend
npm run dev

# 新终端，在前端目录  
cd ../
npm run dev
```

## 🔧 VPN 环境特殊配置

### CORS 配置已优化

后端已自动支持以下来源：
- `localhost` 和 `127.0.0.1`
- 局域网 IP 地址 (`192.168.x.x`, `10.x.x.x`)
- 开发环境下自动允许所有来源

### 前端代理配置已优化

- 使用 `127.0.0.1` 替代 `localhost`
- 增加了超时设置和错误日志
- 启用了详细的代理调试信息

### API 客户端已优化

- 支持 VPN 模式直连后端
- 增加了请求重试机制
- 详细的错误日志和调试信息

## 🚀 测试连接

### 方法 1: 使用诊断脚本

```bash
cd backend
npm run check-admin  # 检查管理员账户
npm run test-api     # 测试API连接
```

### 方法 2: 手动测试

打开浏览器访问：
- 前端：http://127.0.0.1:5173
- 后端健康检查：http://127.0.0.1:3002/health

### 方法 3: 浏览器开发者工具

1. 打开浏览器开发者工具 (F12)
2. 查看 Console 选项卡的日志
3. 查看 Network 选项卡的请求状态

## 🐛 常见问题排查

### 问题 1: "API端点未找到"

**原因**：前端无法连接到后端

**解决**：
1. 确认后端服务运行在 3002 端口
2. 设置 `VITE_VPN_MODE=true`
3. 检查防火墙设置

### 问题 2: CORS 错误

**原因**：跨域请求被阻止

**解决**：
1. 后端已自动处理，重启后端服务
2. 检查浏览器控制台的具体 CORS 错误信息

### 问题 3: 连接超时

**原因**：VPN 网络延迟

**解决**：
1. 客户端已增加重试机制
2. 检查 VPN 连接稳定性
3. 尝试使用不同的 VPN 服务器节点

### 问题 4: 管理员账户不存在

**原因**：数据库未正确初始化

**解决**：
```bash
cd backend
npm run seed  # 重新生成测试数据
```

## 📝 管理员登录信息

- **邮箱**: `admin@wz.com`
- **密码**: `123456`

## 🔍 调试模式

启用详细日志：

1. 打开浏览器开发者工具
2. 查看控制台日志，会显示：
   - `🌐 API请求`: 发送的请求
   - `✅ API响应`: 服务器响应  
   - `🔄 代理请求`: Vite 代理日志
   - `❌ API请求失败`: 错误详情

## 💡 最佳实践

1. **使用 127.0.0.1 而不是 localhost**：在 VPN 环境下更稳定
2. **启用 VPN 模式**：绕过代理直连后端
3. **查看浏览器日志**：详细的调试信息帮助定位问题
4. **网络稳定性**：确保 VPN 连接稳定

## 🆘 如果问题仍然存在

请提供以下信息：

1. 浏览器控制台的错误日志
2. VPN 软件和节点信息
3. 操作系统版本
4. 网络配置详情

这将帮助进一步诊断和解决问题。

